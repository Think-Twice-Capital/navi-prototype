<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NAVI Prototype - Test Runner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1a1a2e;
            color: #eee;
            padding: 20px;
            min-height: 100vh;
        }

        h1 {
            margin-bottom: 10px;
            color: #00d4ff;
        }

        .instructions {
            background: #16213e;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            line-height: 1.6;
        }

        .instructions code {
            background: #0d0d1a;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: Monaco, monospace;
        }

        .test-controls {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        button.primary {
            background: #00d4ff;
            color: #1a1a2e;
        }

        button.primary:hover {
            background: #00b8e6;
        }

        button.secondary {
            background: #333;
            color: #eee;
        }

        button.secondary:hover {
            background: #444;
        }

        .summary {
            display: flex;
            gap: 20px;
            padding: 15px;
            background: #16213e;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .summary-item {
            text-align: center;
        }

        .summary-value {
            font-size: 28px;
            font-weight: bold;
        }

        .summary-value.pass { color: #27ae60; }
        .summary-value.fail { color: #e74c3c; }
        .summary-value.pending { color: #f39c12; }

        .summary-label {
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
        }

        .test-suite {
            background: #16213e;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .test-suite h3 {
            font-size: 14px;
            color: #00d4ff;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .test-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: #1a1a2e;
            border-radius: 6px;
            margin-bottom: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .test-item:hover {
            background: #222;
        }

        .test-status {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            flex-shrink: 0;
            font-weight: bold;
        }

        .test-status.pass {
            background: #27ae60;
        }

        .test-status.fail {
            background: #e74c3c;
        }

        .test-status.pending {
            background: #444;
            border: 2px solid #666;
        }

        .test-name {
            flex: 1;
            font-size: 13px;
        }

        .test-action {
            font-size: 11px;
            color: #888;
            padding: 4px 8px;
            background: #333;
            border-radius: 4px;
        }

        .log {
            background: #0d0d1a;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-entry {
            padding: 3px 0;
        }

        .log-entry.info { color: #3498db; }
        .log-entry.success { color: #27ae60; }
        .log-entry.error { color: #e74c3c; }
        .log-entry.warn { color: #f39c12; }

        .prototype-link {
            display: inline-block;
            margin-top: 10px;
            color: #00d4ff;
            text-decoration: none;
        }

        .prototype-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h1>NAVI Prototype Test Runner</h1>

    <div class="instructions">
        <strong>How to use:</strong><br>
        1. Open the prototype in a new tab: <a href="../index.html" target="_blank" class="prototype-link">Open Prototype</a><br>
        2. Run each test manually in the prototype<br>
        3. Click the test item here to mark it as pass/fail<br>
        4. Use "Reset All" to start fresh
    </div>

    <div class="test-controls">
        <button class="secondary" onclick="resetAll()">Reset All</button>
        <button class="secondary" onclick="markAllPass()">Mark All Pass</button>
        <button class="secondary" onclick="exportResults()">Export Results</button>
    </div>

    <div class="summary">
        <div class="summary-item">
            <div class="summary-value pass" id="pass-count">0</div>
            <div class="summary-label">Passed</div>
        </div>
        <div class="summary-item">
            <div class="summary-value fail" id="fail-count">0</div>
            <div class="summary-label">Failed</div>
        </div>
        <div class="summary-item">
            <div class="summary-value pending" id="pending-count">0</div>
            <div class="summary-label">Pending</div>
        </div>
    </div>

    <div id="test-suites"></div>

    <div class="log" id="test-log"></div>

    <script>
        // Test definitions
        const testSuites = {
            'Navigation': [
                { id: 'nav-1', name: 'Stream tab is highlighted by default', action: 'Check blue highlight on Stream tab' },
                { id: 'nav-2', name: 'Click Espaços tab → shows Spaces view', action: 'Click Espaços, verify grid appears' },
                { id: 'nav-3', name: 'Click Ações tab → shows Actions view', action: 'Click Ações, verify tasks appear' },
                { id: 'nav-4', name: 'Click Pulse tab → shows Pulse view', action: 'Click Pulse, verify dial appears' },
                { id: 'nav-5', name: 'Click AI tab → shows AI view', action: 'Click AI, verify suggestions appear' },
                { id: 'nav-6', name: 'Click Stream tab → returns to Stream', action: 'Click Stream, verify messages appear' },
                { id: 'nav-7', name: 'Compose bar hidden on non-Stream views', action: 'Go to Ações, verify compose bar hidden' },
                { id: 'nav-8', name: 'Compose bar visible on Stream view', action: 'Return to Stream, verify compose bar visible' }
            ],
            'Compose & Send': [
                { id: 'compose-1', name: 'Can type in compose input', action: 'Type text in input field' },
                { id: 'compose-2', name: 'Send button works', action: 'Click send button with text' },
                { id: 'compose-3', name: 'New message appears at top', action: 'Verify new message group at top of stream' },
                { id: 'compose-4', name: 'Input clears after send', action: 'Verify input is empty after send' },
                { id: 'compose-5', name: 'Toast appears after send', action: 'Verify toast slides up' },
                { id: 'compose-6', name: 'AI detects space correctly', action: 'Send "pagar conta", verify Casa badge' },
                { id: 'compose-7', name: 'Toast auto-dismisses', action: 'Wait 3 seconds, verify toast disappears' },
                { id: 'compose-8', name: 'Can tap toast to dismiss', action: 'Send message, tap toast immediately' }
            ],
            'Space Selection': [
                { id: 'space-1', name: 'Mudar button opens modal', action: 'Send message, click Mudar on toast' },
                { id: 'space-2', name: 'Modal shows all 8 spaces', action: 'Count spaces in modal grid' },
                { id: 'space-3', name: 'Can select different space', action: 'Click on a different space' },
                { id: 'space-4', name: 'Message badge updates', action: 'Verify message badge changed' },
                { id: 'space-5', name: 'Modal closes after selection', action: 'Verify modal closed' },
                { id: 'space-6', name: 'Can close modal with X', action: 'Open modal, click X button' },
                { id: 'space-7', name: 'Can close modal by clicking outside', action: 'Open modal, click dark overlay' }
            ],
            'Message Groups': [
                { id: 'msg-1', name: 'Tap expands message group', action: 'Tap on a message group' },
                { id: 'msg-2', name: 'Action bar appears when expanded', action: 'Verify buttons appear at bottom' },
                { id: 'msg-3', name: 'Pending groups show Mark Done button', action: 'Expand pending group, verify button' },
                { id: 'msg-4', name: 'Done groups only show Reply button', action: 'Expand done group, verify only Reply' },
                { id: 'msg-5', name: 'Tapping elsewhere collapses group', action: 'Tap on different group' },
                { id: 'msg-6', name: 'Only one group expanded at a time', action: 'Try to expand two groups' },
                { id: 'msg-7', name: 'Mark as Done changes status', action: 'Click Mark Done, verify status changes' },
                { id: 'msg-8', name: 'Undo toast appears after marking done', action: 'Verify undo toast shows' },
                { id: 'msg-9', name: 'Undo restores previous status', action: 'Click Desfazer, verify status restored' },
                { id: 'msg-10', name: 'Reply focuses compose bar', action: 'Click Reply, verify input focused' },
                { id: 'msg-11', name: 'Reply shows space context', action: 'Verify space badge in compose bar' }
            ],
            'Tasks (Actions View)': [
                { id: 'task-1', name: 'Task cards are visible', action: 'Go to Ações, verify task cards' },
                { id: 'task-2', name: 'Swipe right reveals green background', action: 'Start swiping task right' },
                { id: 'task-3', name: 'Swipe >100px completes task', action: 'Swipe task fully right' },
                { id: 'task-4', name: 'Completed task slides out', action: 'Verify task animates out' },
                { id: 'task-5', name: 'Undo toast appears', action: 'Verify undo toast shows' },
                { id: 'task-6', name: 'Undo restores task', action: 'Click Desfazer, verify task returns' },
                { id: 'task-7', name: 'Partial swipe snaps back', action: 'Swipe <100px, release' }
            ],
            'Spaces View': [
                { id: 'spaces-1', name: 'Space cards are clickable', action: 'Click on Casa card' },
                { id: 'spaces-2', name: 'Space detail opens', action: 'Verify detail view appears' },
                { id: 'spaces-3', name: 'Back button returns to grid', action: 'Click back arrow' },
                { id: 'spaces-4', name: 'Pending badges show counts', action: 'Verify red badges with numbers' }
            ]
        };

        // State
        let testResults = {};

        // Initialize
        function init() {
            loadResults();
            renderTests();
            updateCounts();
        }

        function loadResults() {
            const saved = localStorage.getItem('navi-test-results');
            if (saved) {
                testResults = JSON.parse(saved);
            }
        }

        function saveResults() {
            localStorage.setItem('navi-test-results', JSON.stringify(testResults));
        }

        function renderTests() {
            const container = document.getElementById('test-suites');
            container.innerHTML = '';

            for (const [suiteName, tests] of Object.entries(testSuites)) {
                const suiteEl = document.createElement('div');
                suiteEl.className = 'test-suite';
                suiteEl.innerHTML = `<h3>${suiteName}</h3>`;

                tests.forEach(test => {
                    const status = testResults[test.id] || 'pending';
                    const testEl = document.createElement('div');
                    testEl.className = 'test-item';
                    testEl.onclick = () => toggleTest(test.id);
                    testEl.innerHTML = `
                        <div class="test-status ${status}">${status === 'pass' ? '✓' : status === 'fail' ? '✗' : '○'}</div>
                        <div class="test-name">${test.name}</div>
                        <div class="test-action">${test.action}</div>
                    `;
                    suiteEl.appendChild(testEl);
                });

                container.appendChild(suiteEl);
            }
        }

        function toggleTest(testId) {
            const current = testResults[testId] || 'pending';
            if (current === 'pending') {
                testResults[testId] = 'pass';
                log(`✓ ${testId}: Marked as PASS`, 'success');
            } else if (current === 'pass') {
                testResults[testId] = 'fail';
                log(`✗ ${testId}: Marked as FAIL`, 'error');
            } else {
                testResults[testId] = 'pending';
                log(`○ ${testId}: Reset to PENDING`, 'info');
            }
            saveResults();
            renderTests();
            updateCounts();
        }

        function updateCounts() {
            let pass = 0, fail = 0, pending = 0;
            const allTests = Object.values(testSuites).flat();

            allTests.forEach(test => {
                const status = testResults[test.id] || 'pending';
                if (status === 'pass') pass++;
                else if (status === 'fail') fail++;
                else pending++;
            });

            document.getElementById('pass-count').textContent = pass;
            document.getElementById('fail-count').textContent = fail;
            document.getElementById('pending-count').textContent = pending;
        }

        function resetAll() {
            testResults = {};
            saveResults();
            renderTests();
            updateCounts();
            log('All tests reset to pending', 'warn');
        }

        function markAllPass() {
            const allTests = Object.values(testSuites).flat();
            allTests.forEach(test => {
                testResults[test.id] = 'pass';
            });
            saveResults();
            renderTests();
            updateCounts();
            log('All tests marked as pass', 'success');
        }

        function exportResults() {
            const allTests = Object.values(testSuites).flat();
            let report = `NAVI Prototype Test Results\n`;
            report += `Date: ${new Date().toLocaleString()}\n\n`;

            let pass = 0, fail = 0;
            for (const [suiteName, tests] of Object.entries(testSuites)) {
                report += `\n## ${suiteName}\n`;
                tests.forEach(test => {
                    const status = testResults[test.id] || 'pending';
                    const icon = status === 'pass' ? '✓' : status === 'fail' ? '✗' : '○';
                    report += `${icon} ${test.name}\n`;
                    if (status === 'pass') pass++;
                    if (status === 'fail') fail++;
                });
            }

            report += `\n\nSummary: ${pass} passed, ${fail} failed, ${allTests.length - pass - fail} pending\n`;

            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `navi-test-results-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            log('Results exported', 'success');
        }

        function log(message, type = 'info') {
            const logEl = document.getElementById('test-log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logEl.insertBefore(entry, logEl.firstChild);
        }

        // Initialize on load
        init();
    </script>
</body>
</html>
